<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>创建vue响应式的数据绑定</title>
</head>

<body>
    <div id="app">

        <input type="text" v-model="text" />
        <span>   {{text}}</span>
    
    </div>
    <script>
        function compile(node, vm) {
            var reg = /\{\{(.*)\}\}/;
            if(node.nodeType===1){
                var  attr=node.attributes;
                for(var i=0;i<attr.length;i++){
                    if(attr[i].nodeName=="v-model"){
                        var name=attr[i].nodeValue
                        node.addEventListener('input', function (e) {
                        vm[name] = e.target.value;
                    });

                    node.value = vm[name];//实例中的data数据赋值给节点
                        node.removeAttribute("v-model")
                    }
                }
            }
            console.log("k",node)
            if(node.nodeType===3){
              
                if(reg.test(node.nodeValue)){
                    var  name= RegExp.$1
                    name=name.trim()
                 
                    node.nodeValue=vm[name]
                }
            }
        }
        function nodeContainer(node, vm,flag) {
        var flag =flag||document.createDocumentFragment(); //创建一个虚拟的节点对象

        var child;
        while (child = node.firstChild) {
            compile(child, vm);
            flag.appendChild(child);
            if (child.firstChild) {
                nodeContainer(child, vm,flag);
            }
        }
        return flag;
    }
    function defineReactive(obj, key, value) {
        Object.defineProperty(obj, key, {
            get: function () {
                console.log("get了值" + value);
                return value;
            },
            set: function (newValue) {
                if (newValue === value) {
                    return;
                }
                value = newValue;
                console.log("set了最新值" + value);
            }
        })
    }

    function observe(obj, vm) {
        Object.keys(obj).forEach(function (key) {
            defineReactive(vm, key, obj[key]);
        })
    }
    function Vue(options) {
        this.data = options.data;
        var data = this.data;
        observe(data, this);
        var id = options.el;
        var dom = nodeContainer(document.getElementById(id), this);
        document.getElementById(id).appendChild(dom);
    }
    var Demo = new Vue({
        el: 'app',
        data: {
            text: 'HelloWorld',
        }
    })
    </script>
</body>

</html>